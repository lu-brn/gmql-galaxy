<tool id="gmql_rest_queries_editor" name="GMLQ Query Editor" version="0.1.1">
  <description>Compile and run GMQL queries.</description>
  <command><![CDATA[
      #if $mode.exec_mode == "execute" :
       mkdir -p results && cd results &&
       python $__tool_directory__/gmql_rest_queries.py
       -user=$authToken
       -cmd=execute
       -name=$file_name
       -value="${query}"
       -log=$log
       -format=$mode.out_format
      #else :
       python $__tool_directory__/gmql_rest_queries.py
       -user=$authToken
       -cmd=$mode.exec_mode
       -name=$file_name
       -value="${query}"
       -log=$log
      #end if
	  ]]></command>
  <inputs>
	<param format="json" name="authToken" type="data" label="Select user"/>
	<param name="file_name" type="text" label="Query Name" >
		<validator type="regex" message="Only alphanumeric characters and underscore are allowed">[\w]+$</validator> 
	</param>
	<param name="query" type="text" area="True" size="10x80" label="Query" >
		<sanitizer>
        <valid initial="default">
            <add value=";"/>
        </valid>
		<mapping initial="default">
			<add source="X" target="__cn__" />
		</mapping>
    </sanitizer>
	</param>
    <conditional name="mode">
      <param name="exec_mode" type="select" label="Save only, compile or run query">
		<option value="compile">Compile query</option>
        <option value="execute">Execute query</option>
      </param>
      <when value="execute">
			<param name="out_format" type="select" label="Output format">
                <option value="gtf">GTF</option>
                <option value="gdm">TAB Delimited (GDM)</option>
            </param>
      </when>
    </conditional>
    </inputs>
	<outputs>
        <data format="txt" name="log" label="${file_name} query log" />
        <!--<collection name="query_results" type="list:list" label="${file_name} Results">-->
            <!--<discover_datasets pattern="(?P&lt;identifier_0&gt;[^_]+)_(?P&lt;identifier_1&gt;[^_]+)\.(?P&lt;ext&gt;[^\._]+)?"  directory="results" />-->
        <!--</collection>-->
        <collection name="query_results" type="list" label="${file_name} Results">
            <discover_datasets pattern="(?P&lt;designation&gt;.*)\.(?P&lt;ext&gt;[^\._]+)?" directory="results" />
            <filter>mode['exec_mode'] == 'execute'</filter>
        </collection>
	</outputs>

    <help>
        <!-- TODO -->
    </help>

</tool>
