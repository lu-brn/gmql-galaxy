<tool id="gmql_select" name="GMQL: SELECT statement" version="0.1.0">
    <macros>
        <import>macros.xml</import>
        <import>select_macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <expand macro="stdio" />
    <command><![CDATA[
        python $__tool_directory__/gmql_select.py $source $params $query
    ]]></command>
    <configfiles>
        <configfile name="source" >#if $input.in_mode == 'c' :
            #echo '%s\n'%($input.ds_source.name)
            #for $file in $input.ds_source
            #if $file.name.endswith( 'meta' ) :
            #set $meta_src = $file
            #echo 'meta\t%s\t%s\n'%($file.name,$file)
            #else :
            #echo 'sample\t%s\t%s\n'%($file.name,$file)
            #end if
            #end for
            #else if $input.in_mode == 'r' :
            #echo '%s\n'%($input.ds_rep_source)
            #else:
            #echo '%s\n'%($input.q_source)
            #end if
        </configfile>
        <inputs name="params" filename="params.json"/>
    </configfiles>
    <inputs>
        <conditional name="input">
            <param name = "in_mode" type="select" display="radio" multiple="false"
                   label="Take as input an existing collection or the result of non materialized query">
                <option value="c">Existing Collection within Galaxy</option>
                <option value="r">Existing Collection in the GMQL Repository</option>
                <option value="q">Non materialized query</option>
            </param>
            <when value="c">
                <param name="ds_source" type="data_collection" collection_type="list" label="Input dataset"/>
            </when>
            <when value="r">
                <param name="gmql_datasets" type="data" format="gmql_repository" label="Working Datasets" />
                <param name="ds_rep_source" type="select" label="Input Dataset">
                    <options from_dataset="gmql_datasets">
                         <column name="value" index="0" />
                    </options>
                </param>
            </when>
            <when value="q">
                <param name="q_source" type="data" format="gmql_query" label="Input is the result of this query: " />
            </when>
        </conditional>
        <param name="materialize" type="select" display="radio" multiple="false"
                   label="Materialize results or only generate query?">
                <option value="y">Yes</option>
                <option value="n">No</option>
        </param>
        <!-- Metadata predicates -->
        <expand macro="select_predicates" pred_type="meta_pred" pred_type_title="Metadata Predicates"
                pred_elem="attribute" pred_elem_label="attribute name" />
        <!-- Region predicates -->
        <expand macro="select_predicates" pred_type="region_pred" pred_type_title="Region Predicates" pred_elem="field"
                pred_elem_label="field name" />
        <!-- Semi-join predicates -->
        <!-- TODO: semi-join predicates -->
    </inputs>
    <outputs>
        <data name="query" format="gmql_query" label="SELECT query"/>
    </outputs>
    <!--<tests>
        <test>
            <param name="ds_source">
                <collection type="list">
                    <element name="smp1" value="sample1.bed"/>
                    <element name="smp1_meta" value="sample1.bed.meta"/>
                    <element name="smp2" value="sample2.bed"/>
                    <element name="smp2_meta" value="sample2.bed.meta"/>
                    <element name="smp3" value="sample3.bed"/>
                    <element name="smp3_meta" value="sample3.bed.meta"/>
                </collection>
            </param>
        </test>
    </tests> -->
    <help><![CDATA[
        TODO: Fill in help.
    ]]></help>
    <expand macro="citations"/>
</tool>