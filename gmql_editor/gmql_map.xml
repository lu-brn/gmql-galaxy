<tool id="gmql_map" name="GMQL: MAP statement" version="0.1">
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <expand macro="stdio" />
    <command><![CDATA[
        python $__tool_directory__/gmql_map.py $source1 $source2 $params $query
    ]]></command>
    <configfiles>
        <configfile name="source1" >#if $input1.in_mode == 'c' :
            #echo '%s\n'%($input1.ds_source.name)
            #for $file in $input1.ds_source
            #if $file.name.endswith( 'meta' ) :
            #set $meta_src = $file
            #echo 'meta\t%s\t%s\n'%($file.name,$file)
            #else :
            #echo 'sample\t%s\t%s\n'%($file.name,$file)
            #end if
            #end for
            #else:
            #echo '%s\n'%($input1.q_source)
            #end if
        </configfile>
        <configfile name="source2" >#if $input2.in_mode == 'c' :
            #echo '%s\n'%($input2.ds_source.name)
            #for $file in $input2.ds_source
            #if $file.name.endswith( 'meta' ) :
            #set $meta_src = $file
            #echo 'meta\t%s\t%s\n'%($file.name,$file)
            #else :
            #echo 'sample\t%s\t%s\n'%($file.name,$file)
            #end if
            #end for
            #else:
            #echo '%s\n'%($input2.q_source)
            #end if
        </configfile>
        <inputs name="params" filename="params.json"/>
    </configfiles>
    <inputs>
        <conditional name="input1">
            <param name = "in_mode" type="select" display="radio" multiple="false"
                   label="Take as input an existing collection or the result of non materialized query">
                <option value="c">Existing Collection</option>
                <option value="q">Non materialized query</option>
            </param>
            <when value="c">
                <param name="ds_source" type="data_collection" collection_type="list" label="Reference dataset"/>
            </when>
            <when value="q">
                <param name="q_source" type="data" format="gmql_query" label="Reference is the result of this query: " />
            </when>
        </conditional>
        <conditional name="input2">
            <param name = "in_mode" type="select" display="radio" multiple="false"
                   label="Take as input an existing collection or the result of non materialized query">
                <option value="c">Existing Collection</option>
                <option value="q">Non materialized query</option>
            </param>
            <when value="c">
                <param name="ds_source" type="data_collection" collection_type="list" label="Experiment dataset"/>
            </when>
            <when value="q">
                <param name="q_source" type="data" format="gmql_query" label="Experiment is the result of this query: " />
            </when>
        </conditional>
    </inputs>
    <outputs>
        <data name="query" format="gmql_query" label="MAP query"/>
    </outputs>
    <help><![CDATA[
        TODO: Fill in help.
    ]]></help>
    <expand macro="citations" />
</tool>